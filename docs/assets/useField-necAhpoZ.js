import{r as v}from"./index-DVXBtNgz.js";import{g as R}from"./focusSafely-BjFYYYEp.js";import{c as U,f as g,b as L,i as P,a as j}from"./utils-DJbZa_IK.js";import{$ as F}from"./useLabels-BxyvzJhL.js";function _(a,e,i){let{validationBehavior:t,focus:d}=a;U(()=>{if(t==="native"&&(i!=null&&i.current)){let l=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";i.current.setCustomValidity(l),i.current.hasAttribute("title")||(i.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(k(i.current))}});let r=g(()=>{e.resetValidation()}),n=g(l=>{var s;e.displayValidation.isInvalid||e.commitValidation();let u=i==null||(s=i.current)===null||s===void 0?void 0:s.form;if(!l.defaultPrevented&&i&&u&&q(u)===i.current){var f;d?d():(f=i.current)===null||f===void 0||f.focus(),R("keyboard")}l.preventDefault()}),o=g(()=>{e.commitValidation()});v.useEffect(()=>{let l=i==null?void 0:i.current;if(!l)return;let s=l.form;return l.addEventListener("invalid",n),l.addEventListener("change",o),s==null||s.addEventListener("reset",r),()=>{l.removeEventListener("invalid",n),l.removeEventListener("change",o),s==null||s.removeEventListener("reset",r)}},[i,n,o,r,t])}function Q(a){let e=a.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function k(a){return{isInvalid:!a.validity.valid,validationDetails:Q(a),validationErrors:a.validationMessage?[a.validationMessage]:[]}}function q(a){for(let e=0;e<a.elements.length;e++){let i=a.elements[e];if(!i.validity.valid)return i}return null}const M={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},B={...M,customError:!0,valid:!1},b={isInvalid:!1,validationDetails:M,validationErrors:[]},N=v.createContext({}),D="__formValidationState"+Date.now();function ee(a){if(a[D]){let{realtimeValidation:e,displayValidation:i,updateValidation:t,resetValidation:d,commitValidation:r}=a[D];return{realtimeValidation:e,displayValidation:i,updateValidation:t,resetValidation:d,commitValidation:r}}return Y(a)}function Y(a){let{isInvalid:e,validationState:i,name:t,value:d,builtinValidation:r,validate:n,validationBehavior:o="aria"}=a;i&&(e||(e=i==="invalid"));let l=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:B}:null,s=v.useMemo(()=>w(z(n,d)),[n,d]);r!=null&&r.validationDetails.valid&&(r=null);let u=v.useContext(N),f=v.useMemo(()=>t?Array.isArray(t)?t.flatMap(c=>h(u[c])):h(u[t]):[],[u,t]),[C,A]=v.useState(u),[x,m]=v.useState(!1);u!==C&&(A(u),m(!1));let p=v.useMemo(()=>w(x?[]:f),[x,f]),S=v.useRef(b),[V,y]=v.useState(b),$=v.useRef(b),T=()=>{if(!O)return;E(!1);let c=s||r||S.current;I(c,$.current)||($.current=c,y(c))},[O,E]=v.useState(!1);return v.useEffect(T),{realtimeValidation:l||p||s||r||b,displayValidation:o==="native"?l||p||V:l||p||s||r||V,updateValidation(c){o==="aria"&&!I(V,c)?y(c):S.current=c},resetValidation(){let c=b;I(c,$.current)||($.current=c,y(c)),o==="native"&&E(!1),m(!0)},commitValidation(){o==="native"&&E(!0),m(!0)}}}function h(a){return a?Array.isArray(a)?a:[a]:[]}function z(a,e){if(typeof a=="function"){let i=a(e);if(i&&typeof i!="boolean")return h(i)}return[]}function w(a){return a.length?{isInvalid:!0,validationErrors:a,validationDetails:B}:null}function I(a,e){return a===e?!0:a&&e&&a.isInvalid===e.isInvalid&&a.validationErrors.length===e.validationErrors.length&&a.validationErrors.every((i,t)=>i===e.validationErrors[t])&&Object.entries(a.validationDetails).every(([i,t])=>e.validationDetails[i]===t)}function ae(...a){let e=new Set,i=!1,t={...M};for(let n of a){var d,r;for(let o of n.validationErrors)e.add(o);i||(i=n.isInvalid);for(let o in t)(d=t)[r=o]||(d[r]=n.validationDetails[o])}return t.valid=!i,{isInvalid:i,validationErrors:[...e],validationDetails:t}}function G(a){let{id:e,label:i,"aria-labelledby":t,"aria-label":d,labelElementType:r="label"}=a;e=L(e);let n=L(),o={};i?(t=t?`${n} ${t}`:n,o={id:n,htmlFor:r==="label"?e:void 0}):!t&&!d&&console.warn("If you do not provide a visible label, you must specify an aria-label or aria-labelledby attribute for accessibility");let l=F({id:e,"aria-label":d,"aria-labelledby":t});return{labelProps:o,fieldProps:l}}function ie(a){let{description:e,errorMessage:i,isInvalid:t,validationState:d}=a,{labelProps:r,fieldProps:n}=G(a),o=P([!!e,!!i,t,d]),l=P([!!e,!!i,t,d]);return n=j(n,{"aria-describedby":[o,l,a["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:r,fieldProps:n,descriptionProps:{id:o},errorMessageProps:{id:l}}}export{ee as $,ie as a,_ as b,G as c,D as d,b as e,ae as f};
