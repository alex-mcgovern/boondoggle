import{b as oe}from"./platform-Dv8lzYqa.js";import{r as L,R as le}from"./index-DVXBtNgz.js";import{f as V,$ as re,d as ae}from"./utils-gqPcjMo1.js";import{$ as ne}from"./useResizeObserver-B8nJL-Cs.js";import{$ as ce}from"./context-1CWQQeam.js";import{$ as ie}from"./useControlledState-DO5k2rCg.js";function Y(t,e=-1/0,o=1/0){return Math.min(Math.max(t,e),o)}function A(t,e){let o=t,l=e.toString(),r=l.indexOf("."),a=r>=0?l.length-r:0;if(a>0){let c=Math.pow(10,a);o=Math.round(o*c)/c}return o}function Ie(t,e,o,l){e=Number(e),o=Number(o);let r=(t-(isNaN(e)?0:e))%l,a=A(Math.abs(r)*2>=l?t+Math.sign(r)*(l-Math.abs(r)):t-r,l);return isNaN(e)?!isNaN(o)&&a>o&&(a=Math.floor(A(o/l,l))*l):a<e?a=e:!isNaN(o)&&a>o&&(a=e+Math.floor(A((o-e)/l,l))*l),a=A(a,l),a}const R={top:"top",bottom:"top",left:"left",right:"left"},O={top:"bottom",bottom:"top",left:"right",right:"left"},se={top:"left",left:"top"},X={top:"height",left:"width"},J={width:"totalWidth",height:"totalHeight"},k={};let E=typeof document<"u"&&window.visualViewport;function Z(t){let e=0,o=0,l=0,r=0,a=0,c=0,n={},d=(E==null?void 0:E.scale)>1;if(t.tagName==="BODY"){let m=document.documentElement;l=m.clientWidth,r=m.clientHeight;var i;e=(i=E==null?void 0:E.width)!==null&&i!==void 0?i:l;var p;o=(p=E==null?void 0:E.height)!==null&&p!==void 0?p:r,n.top=m.scrollTop||t.scrollTop,n.left=m.scrollLeft||t.scrollLeft,E&&(a=E.offsetTop,c=E.offsetLeft)}else({width:e,height:o,top:a,left:c}=N(t)),n.top=t.scrollTop,n.left=t.scrollLeft,l=e,r=o;return oe()&&(t.tagName==="BODY"||t.tagName==="HTML")&&d&&(n.top=0,n.left=0,a=E.pageTop,c=E.pageLeft),{width:e,height:o,totalWidth:l,totalHeight:r,scroll:n,top:a,left:c}}function fe(t){return{top:t.scrollTop,left:t.scrollLeft,width:t.scrollWidth,height:t.scrollHeight}}function j(t,e,o,l,r,a,c){let n=r.scroll[t],d=l[X[t]],i=l.scroll[R[t]]+a,p=d+l.scroll[R[t]]-a,m=e-n+c[t]-l[R[t]],h=e-n+o+c[t]-l[R[t]];return m<i?i-m:h>p?Math.max(p-h,i-m):0}function pe(t){let e=window.getComputedStyle(t);return{top:parseInt(e.marginTop,10)||0,bottom:parseInt(e.marginBottom,10)||0,left:parseInt(e.marginLeft,10)||0,right:parseInt(e.marginRight,10)||0}}function U(t){if(k[t])return k[t];let[e,o]=t.split(" "),l=R[e]||"right",r=se[l];R[o]||(o="center");let a=X[l],c=X[r];return k[t]={placement:e,crossPlacement:o,axis:l,crossAxis:r,size:a,crossSize:c},k[t]}function y(t,e,o,l,r,a,c,n,d,i){let{placement:p,crossPlacement:m,axis:h,crossAxis:s,size:w,crossSize:g}=l,f={};f[s]=t[s],m==="center"?f[s]+=(t[g]-o[g])/2:m!==s&&(f[s]+=t[g]-o[g]),f[s]+=a;const P=t[s]-o[g]+d+i,u=t[s]+t[g]-d-i;if(f[s]=Y(f[s],P,u),p===h){const v=n?c[w]:e[J[w]];f[O[h]]=Math.floor(v-t[h]+r)}else f[h]=Math.floor(t[h]+t[w]+r);return f}function de(t,e,o,l,r,a,c,n){const d=l?o.height:e[J.height];let i=t.top!=null?o.top+t.top:o.top+(d-t.bottom-c),p=n!=="top"?Math.max(0,e.height+e.top+e.scroll.top-i-(r.top+r.bottom+a)):Math.max(0,i+c-(e.top+e.scroll.top)-(r.top+r.bottom+a));return Math.min(e.height-a*2,p)}function B(t,e,o,l,r,a){let{placement:c,axis:n,size:d}=a;return c===n?Math.max(0,o[n]-t[n]-t.scroll[n]+e[n]-l[n]-l[O[n]]-r):Math.max(0,t[d]+t[n]+t.scroll[n]-e[n]-o[n]-o[d]-l[n]-l[O[n]]-r)}function ue(t,e,o,l,r,a,c,n,d,i,p,m,h,s,w,g){let f=U(t),{size:P,crossAxis:u,crossSize:v,placement:M,crossPlacement:T}=f,b=y(e,n,o,f,p,m,i,h,w,g),H=p,C=B(n,i,e,r,a+p,f);if(c&&l[P]>C){let F=U(`${O[M]} ${T}`),te=y(e,n,o,F,p,m,i,h,w,g);B(n,i,e,r,a+p,F)>C&&(f=F,b=te,H=p)}let x="bottom";f.axis==="top"?f.placement==="top"?x="top":f.placement==="bottom"&&(x="bottom"):f.crossAxis==="top"&&(f.crossPlacement==="top"?x="bottom":f.crossPlacement==="bottom"&&(x="top"));let I=j(u,b[u],o[v],n,d,a,i);b[u]+=I;let S=de(b,n,i,h,r,a,o.height,x);s&&s<S&&(S=s),o.height=Math.min(o.height,S),b=y(e,n,o,f,H,m,i,h,w,g),I=j(u,b[u],o[v],n,d,a,i),b[u]+=I;let z={},K=e[u]+.5*e[v]-o[u];const Q=w/2+g,W=o[v]-w/2-g,_=e[u]-o[u]+w/2,D=e[u]+e[v]-o[u]-w/2,ee=Y(K,_,D);return z[u]=Y(ee,Q,W),{position:b,maxHeight:S,arrowOffsetLeft:z.left,arrowOffsetTop:z.top,placement:f.placement}}function $e(t){let{placement:e,targetNode:o,overlayNode:l,scrollNode:r,padding:a,shouldFlip:c,boundaryElement:n,offset:d,crossOffset:i,maxHeight:p,arrowSize:m=0,arrowBoundaryOffset:h=0}=t,s=l instanceof HTMLElement?me(l):document.documentElement,w=s===document.documentElement;const g=window.getComputedStyle(s).position;let f=!!g&&g!=="static",P=w?N(o):G(o,s);if(!w){let{marginTop:C,marginLeft:x}=window.getComputedStyle(o);P.top+=parseInt(C,10)||0,P.left+=parseInt(x,10)||0}let u=N(l),v=pe(l);u.width+=v.left+v.right,u.height+=v.top+v.bottom;let M=fe(r),T=Z(n),b=Z(s),H=n.tagName==="BODY"?N(s):G(s,n);return s.tagName==="HTML"&&n.tagName==="BODY"&&(b.scroll.top=0,b.scroll.left=0),ue(e,P,u,M,v,a,c,T,b,H,d,i,f,p,m,h)}function N(t){let{top:e,left:o,width:l,height:r}=t.getBoundingClientRect(),{scrollTop:a,scrollLeft:c,clientTop:n,clientLeft:d}=document.documentElement;return{top:e+a-n,left:o+c-d,width:l,height:r}}function G(t,e){let o=window.getComputedStyle(t),l;if(o.position==="fixed"){let{top:r,left:a,width:c,height:n}=t.getBoundingClientRect();l={top:r,left:a,width:c,height:n}}else{l=N(t);let r=N(e),a=window.getComputedStyle(e);r.top+=(parseInt(a.borderTopWidth,10)||0)-e.scrollTop,r.left+=(parseInt(a.borderLeftWidth,10)||0)-e.scrollLeft,l.top-=r.top,l.left-=r.left}return l.top-=parseInt(o.marginTop,10)||0,l.left-=parseInt(o.marginLeft,10)||0,l}function me(t){let e=t.offsetParent;if(e&&e===document.body&&window.getComputedStyle(e).position==="static"&&!q(e)&&(e=document.documentElement),e==null)for(e=t.parentElement;e&&!q(e);)e=e.parentElement;return e||document.documentElement}function q(t){let e=window.getComputedStyle(t);return e.transform!=="none"||/transform|perspective/.test(e.willChange)||e.filter!=="none"||e.contain==="paint"||"backdropFilter"in e&&e.backdropFilter!=="none"||"WebkitBackdropFilter"in e&&e.WebkitBackdropFilter!=="none"}const ge=new WeakMap;function he(t){let{triggerRef:e,isOpen:o,onClose:l}=t;L.useEffect(()=>{if(!o||l===null)return;let r=a=>{let c=a.target;if(!e.current||c instanceof Node&&!c.contains(e.current))return;let n=l||ge.get(e.current);n&&n()};return window.addEventListener("scroll",r,!0),()=>{window.removeEventListener("scroll",r,!0)}},[o,l,e])}let $=typeof document<"u"&&window.visualViewport;function Re(t){let{direction:e}=ce(),{arrowSize:o=0,targetRef:l,overlayRef:r,scrollRef:a=r,placement:c="bottom",containerPadding:n=12,shouldFlip:d=!0,boundaryElement:i=typeof document<"u"?document.body:null,offset:p=0,crossOffset:m=0,shouldUpdatePosition:h=!0,isOpen:s=!0,onClose:w,maxHeight:g,arrowBoundaryOffset:f=0}=t,[P,u]=L.useState({position:{},arrowOffsetLeft:void 0,arrowOffsetTop:void 0,maxHeight:void 0,placement:void 0}),v=[h,c,r.current,l.current,a.current,n,d,i,p,m,s,e,g,f,o],M=L.useRef($==null?void 0:$.scale);L.useEffect(()=>{s&&(M.current=$==null?void 0:$.scale)},[s]);let T=L.useCallback(()=>{if(h===!1||!s||!r.current||!l.current||!a.current||!i||($==null?void 0:$.scale)!==M.current)return;!g&&r.current&&(r.current.style.maxHeight="none");let C=$e({placement:be(c,e),overlayNode:r.current,targetNode:l.current,scrollNode:a.current,padding:n,shouldFlip:d,boundaryElement:i,offset:p,crossOffset:m,maxHeight:g,arrowSize:o,arrowBoundaryOffset:f});Object.keys(C.position).forEach(x=>r.current.style[x]=C.position[x]+"px"),r.current.style.maxHeight=C.maxHeight!=null?C.maxHeight+"px":void 0,u(C)},v);V(T,v),we(T),ne({ref:r,onResize:T});let b=L.useRef(!1);V(()=>{let C,x=()=>{b.current=!0,clearTimeout(C),C=setTimeout(()=>{b.current=!1},500),T()},I=()=>{b.current&&x()};return $==null||$.addEventListener("resize",x),$==null||$.addEventListener("scroll",I),()=>{$==null||$.removeEventListener("resize",x),$==null||$.removeEventListener("scroll",I)}},[T]);let H=L.useCallback(()=>{b.current||w()},[w,b]);return he({triggerRef:l,isOpen:s,onClose:w&&H}),{overlayProps:{style:{position:"absolute",zIndex:1e5,...P.position,maxHeight:P.maxHeight}},placement:P.placement,arrowProps:{"aria-hidden":"true",role:"presentation",style:{left:P.arrowOffsetLeft,top:P.arrowOffsetTop}},updatePosition:T}}function we(t){V(()=>(window.addEventListener("resize",t,!1),()=>{window.removeEventListener("resize",t,!1)}),[t])}function be(t,e){return e==="rtl"?t.replace("start","right").replace("end","left"):t.replace("start","left").replace("end","right")}function Ne(t){let[e,o]=ie(t.isOpen,t.defaultOpen||!1,t.onOpenChange);const l=L.useCallback(()=>{o(!0)},[o]),r=L.useCallback(()=>{o(!1)},[o]),a=L.useCallback(()=>{o(!e)},[o,e]);return{isOpen:e,setOpen:o,open:l,close:r,toggle:a}}const ve=L.createContext({placement:"bottom"});function xe(t,e){[t,e]=re(t,e,ve);let o=t.placement,l={position:"absolute",[o]:"100%",transform:o==="top"||o==="bottom"?"translateX(-50%)":"translateY(-50%)"},r=ae({...t,defaultClassName:"react-aria-OverlayArrow",values:{placement:o}});return r.style&&Object.keys(r.style).forEach(a=>r.style[a]===void 0&&delete r.style[a]),le.createElement("div",{...t,...r,style:{...l,...r.style},ref:e,"data-placement":o})}const Se=L.forwardRef(xe);export{Se as $,Ne as a,Re as b,ve as c,Ie as d,Y as e,ge as f};
