import{a as b,b as p,c as k}from"./SelectionManager-aXHASKXM.js";import{r as o}from"./index-DVXBtNgz.js";class m{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(t){let e=this.keyMap.get(t);return e?e.prevKey:null}getKeyAfter(t){let e=this.keyMap.get(t);return e?e.nextKey:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(t){return this.keyMap.get(t)}at(t){const e=[...this.getKeys()];return this.getItem(e[t])}getChildren(t){let e=this.keyMap.get(t);return(e==null?void 0:e.childNodes)||[]}constructor(t){this.keyMap=new Map,this.iterable=t;let e=i=>{if(this.keyMap.set(i.key,i),i.childNodes&&i.type==="section")for(let s of i.childNodes)e(s)};for(let i of t)e(i);let l,f=0;for(let[i,s]of this.keyMap)l?(l.nextKey=i,s.prevKey=l.key):(this.firstKey=i,s.prevKey=void 0),s.type==="item"&&(s.index=f++),l=s,l.nextKey=void 0;this.lastKey=l==null?void 0:l.key}}function v(n){let{filter:t}=n,e=b(n),l=o.useMemo(()=>n.disabledKeys?new Set(n.disabledKeys):new Set,[n.disabledKeys]),f=o.useCallback(a=>t?new m(t(a)):new m(a),[t]),i=o.useMemo(()=>({suppressTextValueWarning:n.suppressTextValueWarning}),[n.suppressTextValueWarning]),s=p(n,f,i),h=o.useMemo(()=>new k(s,e),[s,e]);const u=o.useRef(null);return o.useEffect(()=>{if(e.focusedKey!=null&&!s.getItem(e.focusedKey)){const a=u.current.getItem(e.focusedKey),x=[...u.current.getKeys()].map(d=>{const y=u.current.getItem(d);return y.type==="item"?y:null}).filter(d=>d!==null),c=[...s.getKeys()].map(d=>{const y=s.getItem(d);return y.type==="item"?y:null}).filter(d=>d!==null),K=x.length-c.length;let r=Math.min(K>1?Math.max(a.index-K+1,0):a.index,c.length-1),g;for(;r>=0;){if(!h.isDisabled(c[r].key)){g=c[r];break}r<c.length-1?r++:(r>a.index&&(r=a.index),r--)}e.setFocusedKey(g?g.key:null)}u.current=s},[s,h,e,e.focusedKey]),{collection:s,disabledKeys:l,selectionManager:h}}export{v as $,m as a};
